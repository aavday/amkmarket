const body=document.querySelector("body"),header=document.querySelector(".header"),footer=document.querySelector(".footer"),bodyScrollOff=()=>{body.classList.add("lock"),body.style.position="fixed",body.style.width="100%",body.style.top=`-${offset}px`},bodyScrollOn=()=>{body.classList.remove("lock"),body.style.position="",body.style.width="",body.style.top="",window.scrollTo({top:offset})},burger=document.querySelector(".burger"),nav=document.querySelector(".header__inner"),main=document.querySelector(".main");let offset=null;burger.addEventListener("click",()=>{burger.classList.toggle("active"),nav.classList.toggle("active"),main.classList.toggle("active"),footer.classList.toggle("active"),burger.classList.contains("active")?(offset=pageYOffset,bodyScrollOff()):bodyScrollOn()});const anchors=document.querySelectorAll("a[data-scroll]"),intro=document.querySelector(".intro");intro?anchors.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const a=parseInt(getComputedStyle(main).marginTop),r=document.querySelector(t.getAttribute("data-scroll")),o=document.body.getBoundingClientRect().top,c=r.getBoundingClientRect().top-o-a;burger.classList.contains("active")&&(offset="",bodyScrollOn(),burger.classList.toggle("active"),nav.classList.toggle("active"),main.classList.toggle("active"),footer.classList.toggle("active")),0===c&&(anchors.forEach(t=>{t.classList.remove("active")}),document.querySelector('a[data-scroll=".intro"]').classList.add("active")),scrollTo({top:c,behavior:"smooth"})})}):anchors.forEach(t=>{const e=t.getAttribute("href"),a=t.getAttribute("data-scroll").replace(".","");t.setAttribute("href",`${e}#${a}`)}),intro&&pageYOffset<intro.scrollHeight/2&&(anchors.forEach(t=>{t.classList.remove("active")}),document.querySelector('a[data-scroll=".intro"]').classList.add("active"));const catalogue=document.querySelector(".catalogue"),categories=document.querySelector(".categories"),cart=document.querySelector(".cart");if(catalogue||categories?document.querySelector('.header__nav-list-item a[href$="/kategorii"]').classList.add("active"):cart?document.querySelector('.header__nav-list-item a[href$="/korzina"]').classList.add("active"):window.addEventListener("scroll",()=>{document.querySelectorAll(".section").forEach(t=>{const e=t.getBoundingClientRect().top+pageYOffset-300,a=e+t.scrollHeight,r=window.pageYOffset,o=t.getAttribute("id");r>e&&r<a&&(anchors.forEach(t=>{t.classList.remove("active")}),document.querySelector(`a[data-scroll=".${o}"]`).classList.add("active"))})}),document.querySelector(".intro__slider")){tns({container:".intro__slider",items:1,autoplay:!0,autoplayButtonOutput:!1,controls:!1,navPosition:"bottom",mouseDrag:!0})}if(document.querySelector(".feedback__slider")){tns({container:".feedback__slider",items:1,autoplay:!0,autoplayButtonOutput:!1,controls:!1,navPosition:"bottom",mouseDrag:!0})}const catalogueImgsSliderInit=()=>{tns({container:".catalogue__card-imgs-slider",items:1,autoplay:!1,autoplayButtonOutput:!1,controls:!1,navPosition:"bottom",mouseDrag:!0})},modal=document.querySelector(".modal"),modalClose=document.querySelector(".modal-close"),modalOn=()=>{offset=pageYOffset,bodyScrollOff(),modal.classList.toggle("active"),window.innerWidth>1400&&(body.style.paddingRight="17px",footer.style.paddingRight="17px",footer.style.width="calc(100% + 17px)")},modalOff=()=>{bodyScrollOn(),modal.classList.toggle("active"),window.innerWidth>1400&&(body.style.paddingRight="0",footer.style.paddingRight="0",footer.style.width="auto")};modal&&modalClose.addEventListener("click",()=>{bodyScrollOn(),modal.classList.toggle("active"),window.innerWidth>1400&&(body.style.paddingRight="0",footer.style.paddingRight="0",footer.style.width="auto"),deliveryCompaniesDisplayNone()});const modalLinks=document.querySelectorAll(".modal-link");modalLinks.forEach(t=>{t.addEventListener("click",()=>{modalOn()})});const deliveryCompanies=document.querySelectorAll(".delivery-company");deliveryCompanies&&deliveryCompanies.forEach(t=>{t.addEventListener("click",()=>{modalOn();const e=t.classList[0].replace("-logo","");document.querySelector(`.${e}-iframe`).classList.remove("d-none")})});const deliveryCompaniesDisplayNone=()=>{document.querySelectorAll(".modal iframe").forEach(t=>{t.classList.add("d-none")})};let itemsArray=[];const updateArray=()=>{const t=document.querySelectorAll(".catalogue__table-item");itemsArray=[],t.forEach(t=>{const e={};e.name=t.querySelector(".catalogue__table-item-name").textContent.trim(),e.price=t.querySelector(".catalogue__table-item-price").textContent.trim(),e.article=t.querySelector(".catalogue__table-item-article").textContent.trim(),e.thumb=t.querySelector(".catalogue__table-item-thumb div").style.backgroundImage,t.classList.contains("filtered")?e.filtered="filtered":e.filtered="",itemsArray.push(e)})};updateArray();const sortText=(t,e)=>t.name<e.name?-1:t.name<e.name?1:void 0,sortNum=(t,e)=>e.price-t.price,sortByName=t=>{"name-down"===t?itemsArray.sort(sortText):itemsArray.sort(sortText).reverse(),updateList(itemsArray)},sortByPrice=t=>{"price-down"===t?itemsArray.sort(sortNum):itemsArray.sort(sortNum).reverse(),updateList(itemsArray)},catalogueTable=document.querySelector(".catalogue__table tbody"),updateList=t=>{catalogueTable.innerHTML="",t.forEach(t=>{catalogueTable.innerHTML+=`\n      <tr class="catalogue__table-item ${t.filtered}">\n        <td class="catalogue__table-item-thumb">\n            <div style='background-image: ${t.thumb};' alt=""></div>\n        </td>\n        <td class="catalogue__table-item-name">\n            ${t.name}\n        </td>\n        <td class="catalogue__table-item-article">\n          ${t.article}\n        </td>\n        <td class="catalogue__table-item-price">\n            ${t.price}<i class="ml-1 fas fa-ruble-sign"></i>\n        </td>\n      </tr>\n    `}),itemsAddListener()},sortPriceBtn=document.querySelector(".catalogue__sort-by-price"),sortNameBtn=document.querySelector(".catalogue__sort-by-name");sortNameBtn&&sortNameBtn.addEventListener("click",t=>{t.preventDefault(),sortPriceBtn.classList.remove("down","up"),sortNameBtn.classList.contains("down")?(sortByName("name-up"),sortNameBtn.classList.remove("down"),sortNameBtn.classList.add("up")):(sortByName("name-down"),sortNameBtn.classList.add("down"))}),sortPriceBtn&&sortPriceBtn.addEventListener("click",t=>{t.preventDefault(),sortNameBtn.classList.remove("down","up"),sortPriceBtn.classList.contains("down")?(sortByPrice("price-up"),sortPriceBtn.classList.remove("down"),sortPriceBtn.classList.add("up")):(sortByPrice("price-down"),sortPriceBtn.classList.add("down"))});const filterItems=t=>{Array.from(catalogueTable.children).filter(e=>!e.textContent.toLowerCase().includes(t)).forEach(t=>t.classList.add("filtered")),Array.from(catalogueTable.children).filter(e=>e.textContent.toLowerCase().includes(t)).forEach(t=>t.classList.remove("filtered"))},search=document.querySelector(".catalogue__search");search&&search.addEventListener("keyup",()=>{const t=search.value.trim().toLowerCase();filterItems(t),updateArray()});const catalogueCardEmpty=document.querySelector(".catalogue__card-empty"),catalogueCardContent=document.querySelector(".catalogue__card-content"),catalogueCardArticle=document.querySelector(".catalogue__card-article"),catalogueCardName=document.querySelector(".catalogue__card-name"),catalogueCardImgs=document.querySelector(".catalogue__card-imgs"),catalogueCardPrice=document.querySelector(".catalogue__card-price"),catalogueCardDescription=document.querySelector(".catalogue__card-description"),catalogueCardAmount=document.querySelector(".catalogue__card-add-to-cart-amount"),updateCard=(t,e,a,r,o)=>{catalogueCardAmount.value=1,catalogueCardEmpty.classList.add("d-none"),catalogueCardContent.classList.remove("d-none"),catalogueCardArticle.textContent=t,catalogueCardName.textContent=e,catalogueCardPrice.innerHTML=`${r}<i class="ml-1 fas fa-ruble-sign"></i>`,catalogueCardDescription.textContent=o,catalogueCardImgs.innerHTML='\n    <div class="catalogue__card-imgs-slider slider">\n\n    </div>\n  ';const c=document.querySelector(".catalogue__card-imgs-slider");a.forEach(t=>{c.innerHTML+=`\n      <div class="item">\n        <img src="${t}" alt="" class="catalogue__card-img">\n      </div>\n    `}),tns({container:".catalogue__card-imgs-slider",items:1,autoplay:!1,autoplayButtonOutput:!1,controls:!1,navPosition:"bottom",mouseDrag:!0}),itemAdded()},itemsAddListener=()=>{const t=document.querySelectorAll(".catalogue__table-item");let e="",a="",r=[],o="",c="";const l=document.querySelectorAll(".catalogue__info-item");t.forEach(t=>{t.addEventListener("click",()=>{e=t.querySelector(".catalogue__table-item-article").textContent.trim(),a=t.querySelector(".catalogue__table-item-name").textContent.trim(),o=t.querySelector(".catalogue__table-item-price").textContent.trim(),l.forEach(t=>{if(t.querySelector(".catalogue__info-article").textContent.trim()===e&&t.querySelector(".catalogue__info-name").textContent.trim()===a&&t.querySelector(".catalogue__info-price").textContent.trim()===o){c=t.querySelector(".catalogue__info-description").textContent;let e=t.querySelectorAll(".catalogue__info-img");r=[],e.forEach(t=>{r.push(t.textContent)})}}),updateCard(e,a,r,o,c)})})};itemsAddListener();const addToCartLink=document.querySelector(".catalogue__card-add-to-cart"),addToCartAmount=document.querySelector(".catalogue__card-add-to-cart-amount");let addToCartArray=[];JSON.parse(localStorage.getItem("cart-items"))&&(addToCartArray=JSON.parse(localStorage.getItem("cart-items")));let addToCartObj={};addToCartLink&&addToCartLink.addEventListener("click",()=>{if((addToCartObj={}).name=catalogueCardName.textContent.trim(),addToCartObj.price=catalogueCardPrice.textContent.trim(),addToCartObj.amount=addToCartAmount.value,addToCartObj.article=catalogueCardArticle.textContent,JSON.stringify(addToCartArray).includes(addToCartObj.article)){let t=null;for(let e=0;e<addToCartArray.length&&!addToCartArray[e].article.includes(addToCartObj.article);e++)t++;addToCartArray.splice(t,1)}addToCartArray.push(addToCartObj),localStorage.setItem("cart-items",JSON.stringify(addToCartArray)),itemAdded()});const itemAdded=()=>{JSON.stringify(addToCartArray).includes(catalogueCardArticle.textContent)?(catalogueCardContent.querySelector(".fa-shopping-cart").classList.add("d-none"),catalogueCardContent.querySelector(".fa-check").classList.remove("d-none")):(catalogueCardContent.querySelector(".fa-shopping-cart").classList.remove("d-none"),catalogueCardContent.querySelector(".fa-check").classList.add("d-none"))},cartTable=document.querySelector(".cart__table");if(cart){const t=()=>{0===addToCartArray.length&&(cart.querySelector(".cart-empty").classList.remove("d-none"),cart.querySelector(".cart-active").classList.add("d-none"))};t(),JSON.parse(localStorage.getItem("cart-items")).forEach(t=>{cartTable.innerHTML+=`\n      <tr class="cart__table-item">\n        <td class="cart__table-item-name">\n            ${t.name}\n        </td>\n        <td class="cart__table-item-article">\n            ${t.article}\n        </td>\n        <td class="cart__table-item-price">\n            ${t.price}<i class="ml-1 fas fa-ruble-sign"></i>\n        </td>\n        <td class="cart__table-item-quantity">\n          <input type="number" class="cart__table-item-quantity-input" name="amount" value="${t.amount}" min="1">\n        </td>\n        <td class="cart__table-item-delete">\n          <i class="fas fa-times"></i>\n        </td>\n      </tr>\n    `}),document.querySelectorAll(".cart__table-item").forEach(t=>{const e=t.querySelector(".cart__table-item-quantity");e.addEventListener("change",()=>{o(e.parentElement,e.querySelector("input").value),r()});const a=t.querySelector(".cart__table-item-delete");a.addEventListener("click",t=>{t.preventDefault(),c(a.parentElement),r()})});const e=()=>{const t=document.querySelectorAll(".cart__table-item"),e=document.querySelector(".cart__order-form-info"),a=document.querySelector(".cart__order-total-cost").textContent;e.value="",t.forEach(t=>{const a=t.querySelector(".cart__table-item-name").textContent.trim(),r=t.querySelector(".cart__table-item-article").textContent.trim(),o=t.querySelector(".cart__table-item-price").textContent.trim(),c=t.querySelector(".cart__table-item-quantity-input").value;e.value+=`Назв.: ${a}, Арт.: ${r}, Цена за шт.: ${o}, Кол-во: ${c}\n`}),e.value+=`Итого: ${a}`},a=document.querySelector(".cart__order-total-cost"),r=()=>{const t=document.querySelectorAll(".cart__table-item");let r=0;t.forEach(t=>{const e=t.querySelector(".cart__table-item-price").textContent.trim(),a=t.querySelector(".cart__table-item-quantity-input").value;r+=e*a}),a.innerHTML=`${r}<i class="ml-1 fas fa-ruble-sign"></i>`,e()};r();const o=(t,a)=>{let r=0;for(let e=0;e<addToCartArray.length;e++){const a=t.querySelector(".cart__table-item-article").textContent.trim();if(addToCartArray[e].article.includes(a))break;r++}addToCartArray[r].amount=a,localStorage.setItem("cart-items",JSON.stringify(addToCartArray)),e()},c=a=>{a.remove();let r=0;for(let t=0;t<addToCartArray.length;t++){const e=a.querySelector(".cart__table-item-article").textContent.trim();if(addToCartArray[t].article.includes(e))break;r++}addToCartArray.splice(r,1),localStorage.setItem("cart-items",JSON.stringify(addToCartArray)),e(),t()}}